<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Encrypt text messages with Advanced Encryption Standard on Android, iOS, and Web.">
    <title>AES Crypto</title>

    <!-- Icons for various devices -->
    <link rel="apple-touch-icon" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">
    <link rel="icon" sizes="196x196" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">

    <!-- Link to CryptoJS library for encryption functions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>

    <style>
        html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:0 0}
a:active,a:hover{outline:0}
img{border:0}
input,textarea{color:inherit;font:inherit;margin:0}
input::-moz-focus-inner{border:0;padding:0}
input{line-height:normal}
textarea{overflow:auto}
*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}
body,html{height:100%;color:#333}
body{font-family:Helvetica,Arial,sans-serif}
input,textarea{border-radius:3px;border:1px solid #ddd;-webkit-appearance:none;padding:8px}
a{color:#4a8a4e}
img{width:100%}
::-webkit-input-placeholder{color:#aaa}
::-moz-placeholder{color:#aaa}
:-ms-input-placeholder{color:#aaa}
::placeholder{color:#aaa}
h1,h2,h3,h4{margin:2em 0 1em}
h1{font-size:1.7em;margin-top:1.2em}
h2{font-size:1.5em}
h3{font-size:1.2em}
h4{font-size:1em}
.has-noTopMargin{margin-top:0}
.is-textRightAligned{text-align:right}
.layout-outer{height:100%;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}
.EmbedContainer{border:1px solid #6fd274;position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%}
.EmbedContainer embed,.EmbedContainer iframe,.EmbedContainer object{position:absolute;top:0;left:0;width:100%;height:100%}
.Navbar{color:#fff;background-color:#6fd274;padding:8px;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;min-height:53px}
.Navbar-child{width:33.333%;display:inline-block;vertical-align:top}
.Navbar-logoLink{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;text-align:center}
.Navbar-logo{width:20px}
.Navbar-button{color:#fff;text-decoration:none;padding:8px 0}
.BackButtonImage{width:10px;height:1em}
.Content{-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:8px}
.MessageField{-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;min-height:100px;width:100%}
.PasswordGroup{display:-webkit-flex;display:-ms-flexbox;display:flex;padding-bottom:8px;min-height:40px}
.PasswordField{-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;min-width:70%}
.HelpLink{display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-ms-flex-align:center;align-items:center;margin-left:8px;vertical-align:bottom}
.HelpLink-image{width:30px}
.Help{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;padding:8px;max-width:600px;text-align:center;line-height:1.3;margin:0 auto}
.Help-logo{max-width:180px}
.Help-drawing,.Help-server-photo{max-width:400px}
.Review+.Review{margin-top:3em}
.Review-header{margin:0}
.Review-body{margin-top:0}
.Review-stars{color:#ff9500;font-size:1.2em}
.Review-by{margin:0}
    </style>
</head>
<body>
    <div class="layout-outer">
        <!-- Navigation bar with Encrypt and Decrypt buttons -->
        <div class="Navbar">
            <a id="DecryptButton" class="Navbar-button Navbar-child" href="#">Decrypt</a>
            <a class="Navbar-logoLink Navbar-child" href="https://aescrypto.com/" title="AES Crypto Home">
                <img class="Navbar-logo Navbar-child" alt="AES Crypto" src="https://aescrypto.com/images/title.png">
            </a>
            <a id="EncryptButton" class="Navbar-button Navbar-child is-textRightAligned" href="#">Encrypt</a>
        </div>

        <!-- Password input and message textarea for encryption/decryption -->
        <div class="Content">
            <div class="PasswordGroup">
                <input id="PasswordField" type="password" class="PasswordField" placeholder="Password" autocomplete="off">
                <a class="HelpLink" href="https://aescrypto.com/help" title="Help">
                    <img class="HelpLink-image" src="https://aescrypto.com/images/help_icon.png" alt="AES Crypto Help">
                </a>
            </div>
            <textarea id="MessageField" class="MessageField" placeholder="Message"></textarea>
        </div>
    </div>

    <!-- PBKDF2-based AES Encryption/Decryption Script -->
    <script>
    var aesCryptoPBKDF2 = {};

    (function (t) {
        "use strict";
        
        t.formatter = {
            prefix: "AESCryptoV11",
            stringify: function (cipherParams) {
                // Concatenate prefix, salt, IV, and ciphertext for consistency
                return this.prefix + cipherParams.salt.toString() + cipherParams.iv.toString() + cipherParams.ciphertext.toString();
            },
            parse: function (input) {
                var cipherParams = CryptoJS.lib.CipherParams.create({});
                var prefixLen = this.prefix.length;
                
                if (input.indexOf(this.prefix) !== 0) return cipherParams;
                
                // Extract salt and IV from encrypted message based on fixed lengths
                cipherParams.salt = CryptoJS.enc.Hex.parse(input.substring(prefixLen, prefixLen + 32));
                cipherParams.iv = CryptoJS.enc.Hex.parse(input.substring(prefixLen + 32, prefixLen + 64));
                cipherParams.ciphertext = CryptoJS.enc.Hex.parse(input.substring(prefixLen + 64));
                
                return cipherParams;
            }
        };

        t.encrypt = function (message, password) {
            try {
                var salt = CryptoJS.lib.WordArray.random(128 / 8);
                var iv = CryptoJS.lib.WordArray.random(128 / 8);
                var key = CryptoJS.PBKDF2(password, salt, {
                    keySize: 256 / 32,
                    iterations: 10000,
                    hasher: CryptoJS.algo.SHA256
                });
                var encrypted = CryptoJS.AES.encrypt(message, key, { iv: iv });
                
                console.log("Encrypt Salt:", salt.toString());
                console.log("Encrypt IV:", iv.toString());
                console.log("Encrypt Key:", key.toString());
                
                return t.formatter.stringify({ ciphertext: encrypted.ciphertext, salt: salt, iv: iv });
            } catch (e) {
                console.error("Encryption error:", e);
                return "";
            }
        };

        t.decrypt = function (encryptedMessage, password) {
            try {
                var cipherParams = t.formatter.parse(encryptedMessage);
                
                var key = CryptoJS.PBKDF2(password, cipherParams.salt, {
                    keySize: 256 / 32,
                    iterations: 10000,
                    hasher: CryptoJS.algo.SHA256
                });
                
                console.log("Decrypt Salt:", cipherParams.salt.toString());
                console.log("Decrypt IV:", cipherParams.iv.toString());
                console.log("Decrypt Key:", key.toString());
                
                var decrypted = CryptoJS.AES.decrypt(
                    { ciphertext: cipherParams.ciphertext },
                    key,
                    { iv: cipherParams.iv }
                );
                
                return decrypted.toString(CryptoJS.enc.Utf8);
            } catch (e) {
                console.error("Decryption error:", e);
                return "";
            }
        };
    })(aesCryptoPBKDF2);

    document.getElementById("EncryptButton").onclick = function () {
        var password = document.getElementById("PasswordField").value.trim();
        var message = document.getElementById("MessageField").value.trim();
        if (!password || !message) return false;
        document.getElementById("MessageField").value = aesCryptoPBKDF2.encrypt(message, password);
        return false;
    };
    
    document.getElementById("DecryptButton").onclick = function () {
        var password = document.getElementById("PasswordField").value.trim();
        var encryptedMessage = document.getElementById("MessageField").value.trim();
        if (!password || !encryptedMessage) return false;
        
        var decryptedMessage = aesCryptoPBKDF2.decrypt(encryptedMessage, password);
        
        if (decryptedMessage) {
            document.getElementById("MessageField").value = decryptedMessage;
        } else {
            alert("Decryption failed. Check if the password is correct or if the input is properly formatted.");
        }
        return false;
    };
</script>



</body>
</html>
