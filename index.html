<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES Crypto</title>
    <meta name="description" content="Encrypt text messages with Advanced Encryption Standard on Android, iOS, and Web.">
    
    <link rel="apple-touch-icon" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">
    <link rel="icon" sizes="196x196" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">
    <link href="https://plus.google.com/+EvgeniiNeumerzhitckii" rel="author">

    <style>
        html { font-family: sans-serif; text-size-adjust: 100%; }
        body, html { height: 100%; margin: 0; color: #333; }
        body { font-family: Helvetica, Arial, sans-serif; }
        a { color: #4a8a4e; text-decoration: none; }
        img { width: 100%; border: 0; }
        input, textarea { font: inherit; border-radius: 3px; border: 1px solid #ddd; padding: 8px; color: inherit; }
        h1, h2, h3, h4 { margin: 2em 0 1em; }
        h1 { font-size: 1.7em; margin-top: 1.2em; }
        h2 { font-size: 1.5em; }
        .layout-outer { height: 100%; display: flex; flex-direction: column; }
        .Navbar { color: #fff; background-color: #6fd274; padding: 8px; display: flex; align-items: center; min-height: 53px; }
        .Navbar-child { width: 33.333%; display: inline-block; }
        .Content { flex-grow: 1; display: flex; flex-direction: column; padding: 8px; }
        .PasswordGroup, .Help { display: flex; align-items: center; padding-bottom: 8px; }
        .HelpLink-image { width: 30px; }
    </style>
</head>
<body>
    <div class="layout-outer">
        <!-- Navigation bar with Encrypt and Decrypt buttons -->
        <div class="Navbar">
            <a id="DecryptButton" class="Navbar-button Navbar-child" href="#">Decrypt</a>
            <a class="Navbar-logoLink Navbar-child" href="https://aescrypto.com/" title="AES Crypto Home">
                <img class="Navbar-logo" src="https://aescrypto.com/images/title.png" alt="AES Crypto">
            </a>
            <a id="EncryptButton" class="Navbar-button Navbar-child" href="#">Encrypt</a>
        </div>

        <!-- Password input and message textarea for encryption/decryption -->
        <div class="Content">
            <div class="PasswordGroup">
                <input id="PasswordField" type="password" class="PasswordField" placeholder="Password" autocomplete="off">
                <a class="HelpLink" href="https://aescrypto.com/help" title="Help">
                    <img class="HelpLink-image" src="https://aescrypto.com/images/help_icon.png" alt="AES Crypto Help">
                </a>
            </div>
            <textarea id="MessageField" class="MessageField" placeholder="Message"></textarea>
        </div>
    </div>

    <!-- PBKDF2-based AES Encryption/Decryption Script -->
    <script>
        const aesCryptoPBKDF2 = {
            prefix: "AESCryptoV11",
            stringify(cipherParams) {
                return this.prefix + cipherParams.salt.toString() + cipherParams.iv.toString() + cipherParams.ciphertext.toString();
            },
            parse(input) {
                if (!input.startsWith(this.prefix)) return {};
                const prefixLen = this.prefix.length;
                return {
                    salt: CryptoJS.enc.Hex.parse(input.slice(prefixLen, prefixLen + 32)),
                    iv: CryptoJS.enc.Hex.parse(input.slice(prefixLen + 32, prefixLen + 64)),
                    ciphertext: CryptoJS.enc.Hex.parse(input.slice(prefixLen + 64))
                };
            },
            encrypt(message, password) {
                try {
                    const salt = CryptoJS.lib.WordArray.random(128 / 8);
                    const iv = CryptoJS.lib.WordArray.random(128 / 8);
                    const key = CryptoJS.PBKDF2(password, salt, { keySize: 256 / 32, iterations: 10000, hasher: CryptoJS.algo.SHA256 });
                    const encrypted = CryptoJS.AES.encrypt(message, key, { iv });
                    return this.stringify({ ciphertext: encrypted.ciphertext, salt, iv });
                } catch (e) {
                    console.error("Encryption error:", e);
                    return "";
                }
            },
            decrypt(encryptedMessage, password) {
                try {
                    const cipherParams = this.parse(encryptedMessage);
                    const key = CryptoJS.PBKDF2(password, cipherParams.salt, { keySize: 256 / 32, iterations: 10000, hasher: CryptoJS.algo.SHA256 });
                    const decrypted = CryptoJS.AES.decrypt({ ciphertext: cipherParams.ciphertext }, key, { iv: cipherParams.iv });
                    return decrypted.toString(CryptoJS.enc.Utf8);
                } catch (e) {
                    console.error("Decryption error:", e);
                    return "";
                }
            }
        };

        document.getElementById("EncryptButton").onclick = function () {
            const password = document.getElementById("PasswordField").value.trim();
            const message = document.getElementById("MessageField").value.trim();
            if (password && message) {
                document.getElementById("MessageField").value = aesCryptoPBKDF2.encrypt(message, password);
            }
            return false;
        };

        document.getElementById("DecryptButton").onclick = function () {
            const password = document.getElementById("PasswordField").value.trim();
            const encryptedMessage = document.getElementById("MessageField").value.trim();
            const decryptedMessage = aesCryptoPBKDF2.decrypt(encryptedMessage, password);
            document.getElementById("MessageField").value = decryptedMessage || alert("Decryption failed. Check your password and input format.");
            return false;
        };
    </script>
</body>
</html>
