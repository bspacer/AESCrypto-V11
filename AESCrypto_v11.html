<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Encrypt text messages with Advanced Encryption Standard on Android, iOS, and Web.">
    <title>AES Crypto</title>

    <!-- Icons for various devices -->
    <link rel="apple-touch-icon" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">
    <link rel="icon" sizes="196x196" href="https://aescrypto.com/images/homescreen_icons/icon_196.png">

    <!-- Link to CryptoJS library for encryption functions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>

    <!-- External CSS file for styling -->
    <link rel="stylesheet" href="./AES Crypto_files/aes_crypto-5ac15dbe.css">
</head>
<body>
    <div class="layout-outer">
        <!-- Navigation bar with Encrypt and Decrypt buttons -->
        <div class="Navbar">
            <a id="DecryptButton" class="Navbar-button Navbar-child" href="#">Decrypt</a>
            <a class="Navbar-logoLink Navbar-child" href="https://aescrypto.com/" title="AES Crypto Home">
                <img class="Navbar-logo Navbar-child" alt="AES Crypto" src="./AES Crypto_files/title.png">
            </a>
            <a id="EncryptButton" class="Navbar-button Navbar-child is-textRightAligned" href="#">Encrypt</a>
        </div>

        <!-- Password input and message textarea for encryption/decryption -->
        <div class="Content">
            <div class="PasswordGroup">
                <input id="PasswordField" type="password" class="PasswordField" placeholder="Password" autocomplete="off">
                <a class="HelpLink" href="https://aescrypto.com/help" title="Help">
                    <img class="HelpLink-image" src="./AES Crypto_files/help_icon.png" alt="AES Crypto Help">
                </a>
            </div>
            <textarea id="MessageField" class="MessageField" placeholder="Message"></textarea>
        </div>
    </div>

    <!-- PBKDF2-based AES Encryption/Decryption Script -->
    <script>
    var aesCryptoPBKDF2 = {};

    (function (t) {
        "use strict";
        
        t.formatter = {
            prefix: "AESCryptoV11",
            stringify: function (cipherParams) {
                // Concatenate prefix, salt, IV, and ciphertext for consistency
                return this.prefix + cipherParams.salt.toString() + cipherParams.iv.toString() + cipherParams.ciphertext.toString();
            },
            parse: function (input) {
                var cipherParams = CryptoJS.lib.CipherParams.create({});
                var prefixLen = this.prefix.length;
                
                if (input.indexOf(this.prefix) !== 0) return cipherParams;
                
                // Extract salt and IV from encrypted message based on fixed lengths
                cipherParams.salt = CryptoJS.enc.Hex.parse(input.substring(prefixLen, prefixLen + 32));
                cipherParams.iv = CryptoJS.enc.Hex.parse(input.substring(prefixLen + 32, prefixLen + 64));
                cipherParams.ciphertext = CryptoJS.enc.Hex.parse(input.substring(prefixLen + 64));
                
                return cipherParams;
            }
        };

        t.encrypt = function (message, password) {
            try {
                var salt = CryptoJS.lib.WordArray.random(128 / 8);
                var iv = CryptoJS.lib.WordArray.random(128 / 8);
                var key = CryptoJS.PBKDF2(password, salt, {
                    keySize: 256 / 32,
                    iterations: 10000,
                    hasher: CryptoJS.algo.SHA256
                });
                var encrypted = CryptoJS.AES.encrypt(message, key, { iv: iv });
                
                console.log("Encrypt Salt:", salt.toString());
                console.log("Encrypt IV:", iv.toString());
                console.log("Encrypt Key:", key.toString());
                
                return t.formatter.stringify({ ciphertext: encrypted.ciphertext, salt: salt, iv: iv });
            } catch (e) {
                console.error("Encryption error:", e);
                return "";
            }
        };

        t.decrypt = function (encryptedMessage, password) {
            try {
                var cipherParams = t.formatter.parse(encryptedMessage);
                
                var key = CryptoJS.PBKDF2(password, cipherParams.salt, {
                    keySize: 256 / 32,
                    iterations: 10000,
                    hasher: CryptoJS.algo.SHA256
                });
                
                console.log("Decrypt Salt:", cipherParams.salt.toString());
                console.log("Decrypt IV:", cipherParams.iv.toString());
                console.log("Decrypt Key:", key.toString());
                
                var decrypted = CryptoJS.AES.decrypt(
                    { ciphertext: cipherParams.ciphertext },
                    key,
                    { iv: cipherParams.iv }
                );
                
                return decrypted.toString(CryptoJS.enc.Utf8);
            } catch (e) {
                console.error("Decryption error:", e);
                return "";
            }
        };
    })(aesCryptoPBKDF2);

    document.getElementById("EncryptButton").onclick = function () {
        var password = document.getElementById("PasswordField").value.trim();
        var message = document.getElementById("MessageField").value.trim();
        if (!password || !message) return false;
        document.getElementById("MessageField").value = aesCryptoPBKDF2.encrypt(message, password);
        return false;
    };
    
    document.getElementById("DecryptButton").onclick = function () {
        var password = document.getElementById("PasswordField").value.trim();
        var encryptedMessage = document.getElementById("MessageField").value.trim();
        if (!password || !encryptedMessage) return false;
        
        var decryptedMessage = aesCryptoPBKDF2.decrypt(encryptedMessage, password);
        
        if (decryptedMessage) {
            document.getElementById("MessageField").value = decryptedMessage;
        } else {
            alert("Decryption failed. Check if the password is correct or if the input is properly formatted.");
        }
        return false;
    };
</script>



</body>
</html>
